<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>琦媛服务</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../../css/libs/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../../../css/style.css" />
	</head>
	<!--到时候大概五六个月应该可以还翻给你，你急着要用的话我这边可以稳我同事熟人支付宝借呗，借出来还翻给你，-->

	<body>
		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll">
						<a class="mui-control-item" href="#tab">健康管理</a>
						<a class="mui-control-item" href="#item2mobile">美丽定制</a>
						<a class="mui-control-item" href="#item3mobile">体验专区</a>
					</div>
				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-4"></div>
				<div id="muiSliderGroup" class="mui-slider-group">

					<div id="312231" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">' + viewTypeList[index].id +
								<ul class="mui-table-view common-list serving-list"></ul>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
		<script src="../../../js/mui.min.js"></script>
		<script src="../../../js/JRZH.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/appdata.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/mui.pullToRefresh.js"></script>
		<script src="../../../js/mui.pullToRefresh.material.js"></script>
		<script>
			mui.init();
			/*
			 * 初始化数据
			 */
			mui.ready(function() {
				initData();
			});

			mui(".mui-table-view").on("tap", ".mui-table-view-cell a", function() {
				var url = "info.html",
					id = "serving-info",
					extras = {
						id: 2018532
					};
				openInfo(url, id, extras);
			});

			function initData() {
				var topTabs = document.querySelectorAll("#sliderSegmentedControl .mui-scroll")[0];
				var muiSliderGroup = document.querySelectorAll("#muiSliderGroup")[0];
				var rows = 10;
				appData.servingType({}, function(response) {
					var viewTypeList = response.object.viewList;
					var strhtml = "";
					var strCent = "";
					//处理tab下部动画条 
					document.getElementById("sliderProgressBar").classList.add("mui-col-xs-4");
					for(var index in viewTypeList) {
						strhtml += '<a class="mui-control-item" href="#tab' + viewTypeList[index].id + '">' + viewTypeList[index].name + '</a>';
						strCent += '<div id="tab' + viewTypeList[index].id + '" class="mui-slider-item mui-control-content">' +
							'<div class="mui-scroll-wrapper">' +
							'<div class="mui-scroll">' + viewTypeList[index].id +
							'<ul class="mui-table-view common-list serving-list" typeid=' + viewTypeList[index].id + ' page="1" rows="' + rows + '">' +
							'</ul>' +
							'</div>' +
							'</div>' +
							'</div>';
					}

					topTabs.innerHTML = strhtml;
					muiSliderGroup.innerHTML = strCent;
					//阻尼系数
					var deceleration = mui.os.ios ? 0.003 : 0.0009;
					mui('.mui-scroll-wrapper').scroll({
						scrollY: true, //是否竖向滚动
						scrollX: true, //是否横向滚动
						bounce: false,
						indicators: true, //是否显示滚动条
						deceleration: deceleration
					});
					//循环初始化所有下拉刷新，上拉加载。
					mui.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
						mui(pullRefreshEl).pullToRefresh({
							down: {
								callback: function() {
									var self = this;
									setTimeout(function() {
										var ul = self.element.querySelector('.mui-table-view');
										ul.insertBefore(createFragment(ul, index, 10, true), ul.firstChild);
										self.endPullDownToRefresh();
									}, 1000);
								}
							},
							up: {
								callback: function() {
									var self = this;
									setTimeout(function() {
										var ul = self.element.querySelector('.mui-table-view');
										ul.appendChild(createFragment(ul, index, 5));
										self.endPullUpToRefresh();
									}, 1000);
								}
							}
						});
					});
					for(var index in viewTypeList) {
						(function(index) {
							appData.servingList({
								informationType: viewTypeList[index].id,
								page: 1,
								rows: rows
							}, function(response) {
								var listCont = document.querySelectorAll("#tab" + viewTypeList[index].id + " ul")[0];
								var listStr = "";
								var viewList = response.object.viewList;
								for(var i in viewList) {
									var li = document.createElement('li');
									li.className = 'mui-table-view-cell';
									li.innerHTML = '<a href="javascript:;" id="' + viewList[i].id + '">' +
										'<img class="mui-media-object mui-pull-left" src="' + JRZH.port + viewList[i].imageUrl + '">' +
										'<div class="mui-media-body">' +
										'<strong>' + viewList[i].title + '</strong>' +
										'<p>' + viewList[i].synopsis + '</p>' +
										'<div class="foot">' +
										'</div>' +
										'</div>' +
										'</a>';
									listCont.appendChild(li);
								}
							}, function(response) {
								plus.nativeUI.toast(response.message);
							});
						})(index)
					}
				}, function(response) {
					plus.nativeUI.toast(response.message);
				});

			}

			function createFragment(ul, index, count, reverse) {
				var length = ul.querySelectorAll('li').length;
				var fragment = document.createDocumentFragment();
				var li;
				var informationType = "";
				var page = ul.getAttribute("typeid");
				var rows = rows;
				appData.servingList({
					informationType: informationType,
					page: page,
					rows: rows
				}, function(response) {
					console.log(JSON.stringify(response))
				}, function(response) {
					console.log(JSON.stringify(response))
				});

				//				for(var i = 0; i < count; i++) {
				//					li = document.createElement('li');
				//					li.className = 'mui-table-view-cell';
				//					li.innerHTML = '<a href="javascript:;">' +
				//						'<img class="mui-media-object mui-pull-left" src="../../../imgs/temp/server/list.jpg">' +
				//						'<div class="mui-media-body">' +
				//						'<strong>权威专家</strong>' +
				//						'<p>琦媛以疾病预测、疾病预防、健康促进和个性化 健康健康促进和服务，针对早期癌症筛查以及免 疫和代谢性疾病的治疗......</p>' +
				//						'<div class="foot">' +
				//						'</div>' +
				//						'</div>' +
				//						'</a>';
				//
				//					fragment.appendChild(li);
				//				}
				//				return fragment;
			};

			function openInfo(url, id, extras) {
				mui.openWindow({
					url: url,
					id: id,
					styles: {
						top: 0, //新页面顶部位置
						bottom: 0, //新页面底部位置
					},
					extras: extras,
					createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
					show: {
						autoShow: true, //页面loaded事件发生后自动显示，默认为true
						event: 'titleUpdate', //页面显示时机，默认为titleUpdate事件时显示
						extras: {} //窗口动画是否使用图片加速
					},
					waiting: {
						autoShow: true, //自动显示等待框，默认为true
						title: '正在加载...', //等待对话框上显示的提示内容
						options: {}
					}
				})
			}
		</script>
	</body>

</html>